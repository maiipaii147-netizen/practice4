<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>English Practice â€“ 7 Topics</title>
<style>
  body{font-family:Arial,"Noto Sans TC","Noto Sans CJK",sans-serif;background:#f9fafb;color:#111;margin:0}
  header{background:#1d4ed8;color:#fff;padding:12px 16px}
  h1{margin:0;font-size:20px}
  .bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:10px;background:#eef2ff}
  label{font-size:14px}
  select,input[type=range],input[type=text],button{font-size:14px}
  input[type=text]{padding:6px 8px;min-width:160px}
  button{cursor:pointer;border:1px solid #d1d5db;background:#fff;padding:6px 10px;border-radius:8px}
  .primary{background:#111;color:#fff;border-color:#111}
  .tabs{display:flex;gap:8px;padding:10px}
  .tab-btn{border:1px solid #d1d5db;background:#fff;border-radius:999px;padding:6px 12px}
  .tab-btn.active{background:#111;color:#fff;border-color:#111}
  .hint{font-size:12px;color:#6b7280;padding:6px 10px}
  table{width:100%;border-collapse:collapse;background:#fff;margin:10px 0}
  th,td{border:1px solid #e5e7eb;padding:8px;vertical-align:top}
  th{background:#f3f4f6}
  .word-chip{display:inline-flex;gap:6px;align-items:center;border:1px solid #e5e7eb;background:#f8fafc;padding:4px 6px;margin:3px;border-radius:999px}
  .word-voice{border:none;background:#e5e7eb;padding:2px 8px;border-radius:999px;cursor:pointer}
  .speak-btn{background:#111;color:#fff;border-color:#111}
  .muted{color:#6b7280;font-size:13px}
  .wrap{padding:10px}
  .toolbar{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  .badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid #d1d5db;background:#fff}
  .empty{padding:16px;color:#6b7280}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;padding:0 6px;border:1px solid #e5e7eb;border-bottom-width:2px;border-radius:6px;background:#fff}
  .warn{background:#fff7ed;border:1px solid #fdba74;color:#9a3412;padding:8px 10px;border-radius:8px;margin:10px}
</style>
</head>
<body>
<header><h1>English Practice â€“ 7 å¤§ä¸»é¡Œ</h1></header>

<div class="bar">
  <label>Topicï¼š
    <select id="topicSelect"></select>
  </label>
  <label>Voiceï¼š
    <select id="voiceSelect"></select>
  </label>
  <span id="currentVoiceBadge" class="badge">ç›®å‰èªéŸ³ï¼šâ€”</span>
  <label>Rateï¼š
    <input id="rateCtrl" type="range" min="0.6" max="1.4" step="0.05" value="1">
  </label>
  <label>Pitchï¼š
    <input id="pitchCtrl" type="range" min="0.6" max="1.4" step="0.05" value="1">
  </label>
  <input id="search" type="text" placeholder="ğŸ” Search in current tab...">
  <button id="refreshVoicesBtn">ğŸ”„ é‡æ–°è¼‰å…¥èªéŸ³</button>
  <button id="testBtn" class="primary">ğŸ”Š æ¸¬è©¦èªéŸ³</button>
  <button id="stopBtn">â–  åœæ­¢</button>
</div>
<div id="tips" class="hint">è‹¥æ²’è²éŸ³ï¼šå…ˆé»ã€ŒğŸ”Š æ¸¬è©¦èªéŸ³ã€æˆ–ã€ŒğŸ”„ é‡æ–°è¼‰å…¥èªéŸ³ã€ã€‚</div>

<div class="tabs">
  <button class="tab-btn active" data-tab="common">å¸¸è¦‹å•å¥</button>
  <button class="tab-btn" data-tab="dialog">å°è©±</button>
  <button class="tab-btn" data-tab="words">å¿…å‚™å–®å­—</button>
</div>

<div class="wrap" id="content"></div>

<script>
/* â€”â€” å…¨åŸŸéŒ¯èª¤æ””æˆªï¼šç›´æ¥åœ¨é é¢é¡¯ç¤ºéŒ¯èª¤ â€”â€” */
window.onerror = function (msg, src, line, col, err) {
  var tips = document.getElementById('tips');
  var box = document.createElement('div');
  box.className = 'warn';
  box.textContent = 'è…³æœ¬éŒ¯èª¤ï¼š' + msg + (line?(' @'+line+':'+(col||0)):'');
  tips && tips.after(box);
};

/* ================= DATAï¼ˆ7 ä¸»é¡Œï¼‰ ================= */
var DATA = {
  lodging: {
    title: "ä½å®¿è‹±æ–‡ (Hotel/Accommodation)",
    common: [
      { sentence:"Iâ€™d like to make a reservation for one night on the 3rd of June.", zh:"æˆ‘è¦é è¨‚å…­æœˆä¸‰è™Ÿä¸€æ™šçš„æˆ¿é–“ã€‚", tokens:[["Iâ€™d like to","æˆ‘æƒ³è¦"],["make a reservation","é è¨‚"],["for one night","ä¸€æ™š"],["on the 3rd of June","åœ¨å…­æœˆä¸‰è™Ÿ"]] },
      { sentence:"Iâ€™d like to reserve a single room.", zh:"æˆ‘æƒ³è¦é è¨‚ä¸€é–“å–®äººæˆ¿ã€‚", tokens:[["Iâ€™d like to","æˆ‘æƒ³è¦"],["reserve","é è¨‚"],["a single room","å–®äººæˆ¿"]] },
      { sentence:"Could I book a double room for 3 days from (date) to (date)?", zh:"æˆ‘è¦è¨‚ä¸€é–“é›™äººæˆ¿å¾ï¼¿æœˆï¼¿æ—¥åˆ°ï¼¿æœˆï¼¿æ—¥ã€‚", tokens:[["Could I","æˆ‘å¯ä»¥"],["book","è¨‚"],["a double room","é›™äººæˆ¿"],["for 3 days","ä¸‰å¤©"],["from","å¾"],["to","åˆ°"]] },
      { sentence:"Is breakfast included in the room price?", zh:"è«‹å•æˆ¿åƒ¹æœ‰åŒ…å«æ—©é¤å—ï¼Ÿ", tokens:[["Is","æ˜¯å¦"],["breakfast","æ—©é¤"],["included","åŒ…å«"],["in the room price","åœ¨æˆ¿åƒ¹å…§"]] },
      { sentence:"Sorry, I didnâ€™t make a reservation. Do you have any rooms available for tonight?", zh:"ä¸å¥½æ„æ€æˆ‘æ²’æœ‰å…ˆè¨‚æˆ¿ï¼Œä»Šæ™šé‚„æœ‰ç©ºæˆ¿å—ï¼Ÿ", tokens:[["Sorry","ä¸å¥½æ„æ€"],["I didnâ€™t make a reservation","æˆ‘æ²’æœ‰è¨‚æˆ¿"],["rooms available","æœ‰ç©ºæˆ¿"],["for tonight","ä»Šæ™š"]] },
      { sentence:"When is check-in time / check-out time?", zh:"é€²æˆ¿ï¼é€€æˆ¿çš„æ™‚é–“æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", tokens:[["check-in time","é€²æˆ¿æ™‚é–“"],["check-out time","é€€æˆ¿æ™‚é–“"]] },
      { sentence:"Does the room have Internet access?", zh:"æˆ¿é–“è£¡æœ‰ç¶²è·¯å—ï¼Ÿ", tokens:[["the room","æˆ¿é–“"],["have","æœ‰"],["Internet access","ç¶²è·¯é€£ç·š"]] },
      { sentence:"What time can I have breakfast?", zh:"æ—©é¤å¹¾é»é–‹å§‹ä¾›æ‡‰ï¼Ÿ", tokens:[["What time","å¹¾é»"],["have breakfast","ç”¨æ—©é¤"]] },
      { sentence:"Could you call a taxi for me?", zh:"å¯ä»¥å¹«æˆ‘å«è¨ˆç¨‹è»Šå—ï¼Ÿ", tokens:[["Could you","å¯ä»¥éº»ç…©ä½ "],["call a taxi","å«è¨ˆç¨‹è»Š"],["for me","å¹«æˆ‘"]] },
      { sentence:"Iâ€™d like to check out and finalize my bill.", zh:"æˆ‘è¦é€€æˆ¿å’Œçµå¸³ã€‚", tokens:[["check out","é€€æˆ¿"],["finalize my bill","çµæ¸…å¸³å–®"]] }
    ],
    dialog: [
      { sentence:"Hello, I have a reservation under Chen.", zh:"ä½ å¥½ï¼Œæˆ‘ä»¥é™³é€™å€‹åå­—æœ‰è¨‚æˆ¿ã€‚", tokens:[["reservation","è¨‚æˆ¿"],["under","ä»¥â€¦åç¾©"]] },
      { sentence:"May I see your passport, please?", zh:"å¯ä»¥çœ‹ä¸€ä¸‹æ‚¨çš„è­·ç…§å—ï¼Ÿ", tokens:[["May I","æˆ‘å¯ä»¥"],["passport","è­·ç…§"],["please","è«‹"]] },
      { sentence:"Here you are. Also, is breakfast included?", zh:"çµ¦ä½ ã€‚å¦å¤–ï¼Œæˆ¿åƒ¹æœ‰åŒ…å«æ—©é¤å—ï¼Ÿ", tokens:[["Here you are","çµ¦ä½ "],["is â€¦ included","æœ‰åŒ…å«å—"]] },
      { sentence:"Yes, it is. Breakfast is served from 7 to 10 a.m.", zh:"æœ‰çš„ã€‚æ—©é¤ä¾›æ‡‰æ™‚é–“æ˜¯æ—©ä¸Šä¸ƒé»åˆ°åé»ã€‚", tokens:[["is served","ä¾›æ‡‰"],["from â€¦ to â€¦","å¾â€¦åˆ°â€¦"]] },
      { sentence:"Great, thank you.", zh:"å¤ªå¥½äº†ï¼Œè¬è¬ã€‚", tokens:[["Great","å¤ªå¥½äº†"],["thank you","è¬è¬"]] }
    ],
    words: [
      { sentence:"double room", zh:"é›™äººæˆ¿ï¼ˆ1å¼µåºŠï¼‰", tokens:[["double","é›™äºº"],["room","æˆ¿é–“"]] },
      { sentence:"twin room", zh:"é›™åºŠæˆ¿ï¼ˆ2å¼µå–®äººåºŠï¼‰", tokens:[["twin","é›™åºŠ"],["room","æˆ¿é–“"]] },
      { sentence:"triple room", zh:"ä¸‰äººæˆ¿", tokens:[["triple","ä¸‰äºº"],["room","æˆ¿é–“"]] },
      { sentence:"family room", zh:"å®¶åº­æˆ¿ï¼ˆå››äººï¼‰", tokens:[["family","å®¶åº­"],["room","æˆ¿é–“"]] },
      { sentence:"check-in / check-out", zh:"è¾¦ç†å…¥ä½ï¼é€€æˆ¿", tokens:[["check-in","å…¥ä½"],["check-out","é€€æˆ¿"]] },
      { sentence:"reservation", zh:"é è¨‚", tokens:[["reservation","é è¨‚"]] }
    ]
  },

  airport: {
    title: "æ©Ÿå ´è‹±æ–‡ (Airport)",
    common: [
      { sentence:"Would you like to book your seats now?", zh:"ä½ è¦è¨‚æ©Ÿä½å—?", tokens:[["Would you like to","ä½ æƒ³è¦"],["book","é è¨‚"],["seats","åº§ä½"],["now","ç¾åœ¨"]] },
      { sentence:"Would you like a window seat or an aisle seat?", zh:"æ‚¨æƒ³è¦é çª—é‚Šé‚„æ˜¯é èµ°é“çš„ä½ç½®?", tokens:[["window seat","é çª—åº§ä½"],["aisle seat","èµ°é“åº§ä½"]] },
      { sentence:"What is your ticket number?", zh:"æ‚¨çš„æ©Ÿç¥¨è™Ÿç¢¼æ˜¯?", tokens:[["ticket number","æ©Ÿç¥¨è™Ÿç¢¼"]] },
      { sentence:"What gate does the flight board at?", zh:"é€™ç­é£›æ©Ÿè¦åˆ°å“ªä¸€å€‹ç™»æ©Ÿé–€ç™»æ©Ÿï¼Ÿ", tokens:[["gate","ç™»æ©Ÿé–€"],["board","ç™»æ©Ÿ"]] },
      { sentence:"Excuse me, where is Gate __?", zh:"è«‹å•__è™Ÿç™»æ©Ÿé–€åœ¨å“ªè£¡ï¼Ÿ", tokens:[["Excuse me","ä¸å¥½æ„æ€"],["Gate","ç™»æ©Ÿé–€"]] },
      { sentence:"When does the flight begin boarding?", zh:"é€™ç­é£›æ©Ÿå¹¾é»ç™»æ©Ÿï¼Ÿ", tokens:[["begin boarding","é–‹å§‹ç™»æ©Ÿ"]] },
      { sentence:"Excuse me, where is the transfer desk / lounge?", zh:"è«‹å•è½‰æ©Ÿæ«ƒæª¯ / ä¼‘æ¯å®¤åœ¨å“ªè£¡ï¼Ÿ", tokens:[["transfer desk","è½‰æ©Ÿæ«ƒæª¯"],["lounge","ä¼‘æ¯å®¤"]] }
    ],
    dialog: [
      { sentence:"I would like to confirm my flight.", zh:"æˆ‘æƒ³ç¢ºèªæˆ‘çš„ç­æ©Ÿã€‚", tokens:[["confirm","ç¢ºèª"],["flight","èˆªç­"]] },
      { sentence:"Can I get your ticket number?", zh:"è«‹å‘Šè¨´æˆ‘æ‚¨çš„æ©Ÿç¥¨è™Ÿç¢¼ã€‚", tokens:[["ticket number","æ©Ÿç¥¨è™Ÿç¢¼"]] },
      { sentence:"You are scheduled to depart on June 15th at 1:00 p.m. Is this correct?", zh:"æ‚¨é å®šåœ¨6æœˆ15è™Ÿä¸‹åˆä¸€é»èµ·é£›ï¼Œå°å—ï¼Ÿ", tokens:[["scheduled to depart","é å®šèµ·é£›"]] },
      { sentence:"Yes, it is.", zh:"æ˜¯çš„ã€‚", tokens:[["Yes","æ˜¯çš„"]] },
      { sentence:"Your tickets have been confirmed. Please arrive 3 hours before departure.", zh:"å·²ç¢ºèªã€‚è«‹åœ¨èµ·é£›å‰ä¸‰å°æ™‚æŠµé”ã€‚", tokens:[["confirmed","å·²ç¢ºèª"],["departure","èµ·é£›"]] }
    ],
    words: [
      { sentence:"check-in", zh:"è¾¦ç†ç™»æ©Ÿ", tokens:[["check","æª¢æŸ¥"],["in","é€²å…¥"]] },
      { sentence:"delayed", zh:"å»¶èª¤", tokens:[["delayed","å»¶èª¤"]] },
      { sentence:"boarding", zh:"ç™»æ©Ÿ", tokens:[["boarding","ç™»æ©Ÿ"]] },
      { sentence:"gate", zh:"ç™»æ©Ÿé–€", tokens:[["gate","ç™»æ©Ÿé–€"]] },
      { sentence:"departure time", zh:"èµ·é£›æ™‚é–“", tokens:[["departure","å‡ºç™¼"],["time","æ™‚é–“"]] },
      { sentence:"terminal", zh:"èˆªå»ˆ", tokens:[["terminal","èˆªå»ˆ"]] }
    ]
  },

  transport: {
    title: "äº¤é€šè‹±æ–‡ (Transportation)",
    common: [
      { sentence:"Could you tell me where I am now?", zh:"å¯ä»¥å‘Šè¨´æˆ‘é€™æ˜¯å“ªè£¡å—?", tokens:[["where I am","æˆ‘åœ¨å“ªè£¡"],["now","ç¾åœ¨"]] },
      { sentence:"Excuse me. How do I get to the railway station, please?", zh:"æƒ³è«‹å•å¦‚ä½•åˆ°ç«è»Šç«™ï¼Ÿ", tokens:[["How do I get to","æ€éº¼å»"],["railway station","ç«è»Šç«™"]] },
      { sentence:"Excuse me. Whereâ€™s the nearest restaurant, please?", zh:"æœ€è¿‘çš„é¤å»³åœ¨å“ªè£¡ï¼Ÿ", tokens:[["nearest","æœ€è¿‘çš„"],["restaurant","é¤å»³"]] },
      { sentence:"Excuse me. Iâ€™m looking for the Number 8 bus stop.", zh:"æƒ³è«‹å•å…«è™Ÿè»Šç«™ç‰Œåœ¨å“ªè£¡?", tokens:[["looking for","æ­£åœ¨æ‰¾"],["bus stop","å…¬è»Šç«™"]] },
      { sentence:"Itâ€™s easier if I can show you on the map.", zh:"ä½ å¯ä»¥åœ¨åœ°åœ–ä¸ŠæŒ‡çµ¦æˆ‘çœ‹å—ï¼Ÿ", tokens:[["show you","çµ¦ä½ çœ‹"],["on the map","åœ¨åœ°åœ–ä¸Š"]] },
      { sentence:"How long does it take to go to ____?", zh:"åˆ°ï¼¿ï¼¿éœ€è¦å¤šé•·æ™‚é–“ï¼Ÿ", tokens:[["How long","å¤šä¹…"],["does it take","è¦èŠ±å¤šä¹…"]] },
      { sentence:"Would it be better for me to take a taxi/bus?", zh:"æ­è¨ˆç¨‹è»Šï¼å…¬è»Šæœƒæ¯”è¼ƒå¥½å—ï¼Ÿ", tokens:[["take a taxi/bus","æ­è¨ˆç¨‹è»Šï¼å…¬è»Š"]] },
      { sentence:"Itâ€™s about five minutes from here.", zh:"å¾é€™è£¡å¤§ç´„äº”åˆ†é˜ã€‚", tokens:[["about","å¤§ç´„"],["from here","å¾é€™è£¡"]] },
      { sentence:"Itâ€™s about a ten-minute walk.", zh:"å¤§ç´„èµ°ååˆ†é˜ã€‚", tokens:[["ten-minute walk","ååˆ†é˜è·¯ç¨‹"]] },
      { sentence:"Where is the bus stop / taxi stand?", zh:"å…¬è»Šç«™ï¼è¨ˆç¨‹è»Šæ‹›å‘¼ç«™åœ¨å“ªè£¡ï¼Ÿ", tokens:[["bus stop","å…¬è»Šç«™"],["taxi stand","è¨ˆç¨‹è»Šæ‹›å‘¼ç«™"]] },
      { sentence:"How much does it cost to the train station by taxi?", zh:"ä¹˜è¨ˆç¨‹è»Šåˆ°è»Šç«™éœ€è¦å¤šå°‘éŒ¢ï¼Ÿ", tokens:[["How much","å¤šå°‘"],["cost","è²»ç”¨"]] },
      { sentence:"Take me to this address, please.", zh:"è«‹è¼‰æˆ‘å»é€™å€‹åœ°å€ã€‚", tokens:[["Take me to","è¼‰æˆ‘å»"],["address","åœ°å€"]] },
      { sentence:"Please stop right here.", zh:"è«‹åœ¨é€™è£¡åœè»Šã€‚", tokens:[["stop","åœ"],["right here","å°±åœ¨é€™è£¡"]] },
      { sentence:"Can I pay the fare by credit card?", zh:"æˆ‘å¯ä»¥ç”¨ä¿¡ç”¨å¡ä»˜è»Šè³‡å—ï¼Ÿ", tokens:[["pay the fare","ä»˜è»Šè³‡"],["credit card","ä¿¡ç”¨å¡"]] }
    ],
    dialog: [
      { sentence:"Excuse me. Iâ€™m looking for the post office.", zh:"ä¸å¥½æ„æ€ï¼Œæˆ‘åœ¨æ‰¾éƒµå±€ã€‚", tokens:[["post office","éƒµå±€"]] },
      { sentence:"Go straight, then turn left at the crossroads.", zh:"ç›´èµ°ï¼Œç„¶å¾Œåœ¨åå­—è·¯å£å·¦è½‰ã€‚", tokens:[["go straight","ç›´èµ°"],["turn left","å·¦è½‰"],["crossroads","åå­—è·¯å£"]] },
      { sentence:"You can take Bus 8. Get off at the second stop.", zh:"ä½ å¯ä»¥æ­ 8 è™Ÿå…¬è»Šï¼Œåœ¨ç¬¬äºŒç«™ä¸‹è»Šã€‚", tokens:[["take Bus 8","æ­ 8 è™Ÿå…¬è»Š"],["get off","ä¸‹è»Š"],["second stop","ç¬¬äºŒç«™"]] }
    ],
    words: [
      { sentence:"fare", zh:"è»Šè³‡", tokens:[["fare","è»Šè³‡"]] },
      { sentence:"one-way / round trip", zh:"å–®ç¨‹ï¼ä¾†å›", tokens:[["one-way","å–®ç¨‹"],["round trip","ä¾†å›"]] },
      { sentence:"platform", zh:"æœˆå°", tokens:[["platform","æœˆå°"]] },
      { sentence:"timetable", zh:"æ™‚åˆ»è¡¨", tokens:[["timetable","æ™‚åˆ»è¡¨"]] }
    ]
  },

  dining: {
    title: "é¤å»³é»é¤ (Dining)",
    common: [
      { sentence:"A table for two, please.", zh:"è«‹çµ¦æˆ‘å€‘å…©äººåº§ã€‚", tokens:[["table","æ¡Œä½"],["for two","å…©äºº"]] },
      { sentence:"Could we see the menu?", zh:"å¯ä»¥çœ‹ä¸€ä¸‹èœå–®å—ï¼Ÿ", tokens:[["see the menu","çœ‹èœå–®"]] },
      { sentence:"I have a food allergy to peanuts.", zh:"æˆ‘å°èŠ±ç”Ÿéæ•ã€‚", tokens:[["food allergy","é£Ÿç‰©éæ•"],["peanuts","èŠ±ç”Ÿ"]] }
    ],
    dialog: [
      { sentence:"Are you ready to order?", zh:"éœ€è¦é»é¤äº†å—ï¼Ÿ", tokens:[["ready to order","æº–å‚™é»é¤"]] },
      { sentence:"Yes, Iâ€™ll have the grilled chicken.", zh:"è¦ï¼Œæˆ‘è¦çƒ¤é›ã€‚", tokens:[["Iâ€™ll have","æˆ‘è¦é»"],["grilled chicken","çƒ¤é›"]] }
    ],
    words: [
      { sentence:"appetizer / main course / dessert", zh:"å‰èœï¼ä¸»èœï¼ç”œé»", tokens:[["appetizer","å‰èœ"],["main course","ä¸»èœ"],["dessert","ç”œé»"]] }
    ]
  },

  shopping: {
    title: "è³¼ç‰© (Shopping)",
    common: [
      { sentence:"How much is this?", zh:"é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", tokens:[["How much","å¤šå°‘éŒ¢"],["this","é€™å€‹"]] },
      { sentence:"Do you have this in a larger size?", zh:"æœ‰æ›´å¤§çš„å°ºå¯¸å—ï¼Ÿ", tokens:[["larger size","è¼ƒå¤§å°ºå¯¸"]] }
    ],
    dialog: [
      { sentence:"Can I try it on?", zh:"æˆ‘å¯ä»¥è©¦ç©¿å—ï¼Ÿ", tokens:[["try it on","è©¦ç©¿"]] },
      { sentence:"Itâ€™s a bit too small for me.", zh:"å°æˆ‘ä¾†èªªæœ‰é»å¤ªå°ã€‚", tokens:[["too small","å¤ªå°"]] }
    ],
    words: [
      { sentence:"fitting room", zh:"è©¦è¡£é–“", tokens:[["fitting room","è©¦è¡£é–“"]] },
      { sentence:"receipt", zh:"æ”¶æ“š", tokens:[["receipt","æ”¶æ“š"]] }
    ]
  },

  emergency: {
    title: "ç·Šæ€¥æ±‚åŠ© (Emergency)",
    common: [
      { sentence:"Please help! I need a doctor.", zh:"è«‹å¹«å¿™ï¼æˆ‘éœ€è¦é†«ç”Ÿã€‚", tokens:[["I need a doctor","æˆ‘éœ€è¦é†«ç”Ÿ"]] },
      { sentence:"Call the police, please.", zh:"è«‹å¹«æˆ‘å ±è­¦ã€‚", tokens:[["police","è­¦å¯Ÿ"]] }
    ],
    dialog: [
      { sentence:"What happened?", zh:"ç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ", tokens:[["happened","ç™¼ç”Ÿ"]] },
      { sentence:"I lost my passport.", zh:"æˆ‘çš„è­·ç…§ä¸è¦‹äº†ã€‚", tokens:[["lost","ä¸è¦‹"],["passport","è­·ç…§"]] }
    ],
    words: [
      { sentence:"ambulance", zh:"æ•‘è­·è»Š", tokens:[["ambulance","æ•‘è­·è»Š"]] },
      { sentence:"emergency room (ER)", zh:"æ€¥è¨ºå®¤", tokens:[["emergency room","æ€¥è¨ºå®¤"]] }
    ]
  },

  sightseeing: {
    title: "è§€å…‰èˆ‡å•è·¯ (Sightseeing)",
    common: [
      { sentence:"Is there a guided tour available?", zh:"æœ‰å°è¦½è¡Œç¨‹å—ï¼Ÿ", tokens:[["guided tour","å°è¦½"]] },
      { sentence:"What are the opening hours?", zh:"é–‹æ”¾æ™‚é–“æ˜¯ï¼Ÿ", tokens:[["opening hours","é–‹æ”¾æ™‚é–“"]] }
    ],
    dialog: [
      { sentence:"How can I get to the museum?", zh:"è¦æ€éº¼å»åšç‰©é¤¨ï¼Ÿ", tokens:[["get to","å‰å¾€"],["museum","åšç‰©é¤¨"]] },
      { sentence:"Take the metro and get off at Central Station.", zh:"æ­åœ°éµåœ¨ä¸­å¤®è»Šç«™ä¸‹è»Šã€‚", tokens:[["metro","åœ°éµ"],["get off","ä¸‹è»Š"]] }
    ],
    words: [
      { sentence:"audio guide", zh:"èªéŸ³å°è¦½", tokens:[["audio guide","èªéŸ³å°è¦½"]] },
      { sentence:"souvenir", zh:"ç´€å¿µå“", tokens:[["souvenir","ç´€å¿µå“"]] }
    ]
  }
};

/* ================== èªéŸ³åˆæˆï¼ˆWeb Speech APIï¼‰ ================== */
var synth = window.speechSynthesis || null;
var voices = [];

function scoreVoice(v) {
  var name = (v.name || '').toLowerCase();
  var lang = (v.lang || '').toLowerCase();
  // èªç³»å„ªå…ˆåº
  var order = ['zh-tw','en-us','en-gb','en','zh'];
  var langScore = -100, i;
  for (i=0;i<order.length;i++){
    var p = order[i];
    if (lang === p) { langScore = 100 - i*2; break; }
    if (lang.indexOf(p+'-')===0) { langScore = 80 - i*2; break; }
    if (p.length===2 && lang.indexOf(p+'-')===0) { langScore = 70 - i*2; break; }
  }
  // ä¾›æ‡‰å•†
  var vendorScore = name.indexOf('google')>-1 ? 30
                    : name.indexOf('microsoft')>-1 ? 20
                    : (name.indexOf('siri')>-1 || name.indexOf('ios')>-1 || name.indexOf('apple')>-1) ? 10 : 0;
  var localeScore = (name.indexOf('taiwan')>-1 || name.indexOf('zh-tw')>-1 || lang.indexOf('zh-tw')>-1) ? 5 : 0;
  return -(langScore + vendorScore + localeScore);
}

function updateCurrentVoiceBadge() {
  var badge = document.getElementById('currentVoiceBadge');
  var sel = document.getElementById('voiceSelect');
  if (!voices.length || !sel.value) { badge.textContent = 'ç›®å‰èªéŸ³ï¼šâ€”'; return; }
  var i, v=null;
  for (i=0;i<voices.length;i++){ if (voices[i].voiceURI===sel.value){ v=voices[i]; break; } }
  badge.textContent = v ? ('ç›®å‰èªéŸ³ï¼š'+v.name+' ('+v.lang+')') : 'ç›®å‰èªéŸ³ï¼šâ€”';
}

function populateVoices() {
  if (!synth) { showWarn('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³ï¼ˆWeb Speech APIï¼‰ã€‚'); return; }
  voices = synth.getVoices();
  var select = document.getElementById('voiceSelect');
  select.innerHTML = '';
  voices.sort(function(a,b){ return scoreVoice(a)-scoreVoice(b); });
  var savedVoice = localStorage.getItem('ep_voiceURI');
  var found = false;
  for (var i=0;i<voices.length;i++){
    var v = voices[i];
    var opt = document.createElement('option');
    opt.value = v.voiceURI;
    opt.textContent = v.name + ' (' + v.lang + ')';
    if (savedVoice && v.voiceURI===savedVoice){ opt.selected = true; found = true; }
    select.appendChild(opt);
  }
  if (!voices.length){
    var opt2 = document.createElement('option');
    opt2.value = '';
    opt2.textContent = 'ï¼ˆå°šæœªè¼‰å…¥èªéŸ³ï¼Œè«‹æŒ‰ï¼šé‡æ–°è¼‰å…¥èªéŸ³ï¼‰';
    select.appendChild(opt2);
  }
  if (!found && select.options.length){
    select.selectedIndex = 0;
    localStorage.setItem('ep_voiceURI', select.value);
  }
  updateCurrentVoiceBadge();
}

function speak(text, langHint){
  if (!text) return;
  if (!langHint) langHint = 'en-US';
  try { synth && synth.cancel(); } catch(e){}
  var utter = new SpeechSynthesisUtterance(text);
  var rate = parseFloat(document.getElementById('rateCtrl').value || '1');
  var pitch = parseFloat(document.getElementById('pitchCtrl').value || '1');
  utter.rate = rate; utter.pitch = pitch;
  var sel = document.getElementById('voiceSelect');
  var voiceURI = sel.value;
  var i, matched=null;
  for (i=0;i<voices.length;i++){ if (voices[i].voiceURI===voiceURI){ matched=voices[i]; break; } }
  if (matched){ utter.voice = matched; utter.lang = matched.lang || langHint; } else { utter.lang = langHint; }
  synth && synth.speak(utter);
}

/* ================== UI ç‹€æ…‹ä¿å­˜ ================== */
['rateCtrl','pitchCtrl','voiceSelect','topicSelect'].forEach(function(id){
  var el = document.getElementById(id);
  var key = 'ep_'+id;
  var saved = localStorage.getItem(key);
  if (saved!==null) el.value = saved;
  el.addEventListener('change', function(){
    localStorage.setItem(key, el.value);
    if (id==='voiceSelect'){
      localStorage.setItem('ep_voiceURI', el.value);
      updateCurrentVoiceBadge();
    }
  });
});

/* ================== ä¸»é¡Œ/åˆ†é /æœå°‹ æ¸²æŸ“ ================== */
var topicSelect = document.getElementById('topicSelect');
var contentEl = document.getElementById('content');
var tabBtns = (function(){ return Array.prototype.slice.call(document.querySelectorAll('.tab-btn')); })();
var searchInput = document.getElementById('search');

// å¡«å…¥ä¸»é¡Œé¸å–®
for (var k in DATA){
  if (!DATA.hasOwnProperty(k)) continue;
  var opt = document.createElement('option');
  opt.value = k; opt.textContent = DATA[k].title;
  topicSelect.appendChild(opt);
}
var savedTopic = localStorage.getItem('ep_topicSelect');
if (savedTopic && DATA[savedTopic]) topicSelect.value = savedTopic;

// ç›®å‰åˆ†é ï¼ˆä¸ä½¿ç”¨ ?.dataset ä»¥é¿å…ç›¸å®¹æ€§å•é¡Œï¼‰
var currentTab = 'common';
for (var i=0;i<tabBtns.length;i++){
  if (tabBtns[i].className.indexOf('active')>-1){
    currentTab = tabBtns[i].getAttribute('data-tab') || 'common';
    break;
  }
}

for (var i2=0;i2<tabBtns.length;i2++){
  (function(btn){
    btn.addEventListener('click', function(){
      for (var j=0;j<tabBtns.length;j++){ tabBtns[j].classList.remove('active'); }
      btn.classList.add('active');
      currentTab = btn.getAttribute('data-tab');
      render();
    });
  })(tabBtns[i2]);
}

topicSelect.addEventListener('change', function(){
  localStorage.setItem('ep_topicSelect', topicSelect.value);
  render();
});
searchInput.addEventListener('input', function(){ render(); });

// å»ºç«‹å–®å­— chip
function chip(wordPair){
  var en = wordPair[0], zh = wordPair[1];
  var div = document.createElement('span'); div.className='word-chip';
  var enSpan = document.createElement('span'); enSpan.textContent = en;
  var zhSpan = document.createElement('span'); zhSpan.className='muted'; zhSpan.textContent = zh ? '('+zh+')' : '';
  var btn = document.createElement('button'); btn.className='word-voice'; btn.textContent='ğŸ”Š'; btn.title='Play';
  btn.addEventListener('click', function(e){ e.stopPropagation(); speak(en, 'en-US'); });
  div.appendChild(enSpan); if (zh){ div.appendChild(zhSpan); } div.appendChild(btn);
  return div;
}

function emptyNode(){
  var div = document.createElement('div'); div.className='empty';
  div.innerHTML = 'æ‰¾ä¸åˆ°çµæœã€‚è©¦è©¦æ”¹ç”¨å…¶ä»–é—œéµå­—ï¼Œæˆ–æŒ‰ <span class="kbd">Esc</span> æ¸…é™¤æœå°‹ã€‚';
  return div;
}
function escapeHTML(s){
  return (s||'').replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
}

function render(){
  var key = topicSelect.value || Object.keys(DATA)[0];
  var topic = DATA[key]; if (!topic) return;
  var q = (searchInput.value || '').toLowerCase();
  var list = topic[currentTab] || [];
  var filtered = [];
  if (!q){ filtered = list; }
  else {
    for (var i=0;i<list.length;i++){
      var item = list[i];
      var hay = (item.sentence + ' ' + (item.zh||'') + ' ' + (item.tokens||[]).join(' ')).toLowerCase();
      if (hay.indexOf(q)>-1) filtered.push(item);
    }
  }

  if (currentTab==='words'){
    var wrap = document.createElement('div');
    var toolbar = document.createElement('div'); toolbar.className='toolbar';
    var count = document.createElement('span'); count.className='badge'; count.textContent='è©å½™æ•¸ï¼š'+filtered.length;
    toolbar.appendChild(count); wrap.appendChild(toolbar);
    if (!filtered.length){ wrap.appendChild(emptyNode()); contentEl.innerHTML=''; contentEl.appendChild(wrap); return; }
    var box = document.createElement('div');
    for (var i3=0;i3<filtered.length;i3++){
      var it = filtered[i3];
      var row = document.createElement('div'); row.style.margin='6px 0';
      var en = document.createElement('div'); en.innerHTML = '<b>'+escapeHTML(it.sentence)+'</b>';
      var zh = document.createElement('div'); zh.className='muted'; zh.textContent = it.zh || '';
      var tk = document.createElement('div');
      var tokens = it.tokens || [];
      for (var t=0;t<tokens.length;t++){ tk.appendChild(chip(tokens[t])); }
      var btn = document.createElement('button'); btn.className='speak-btn'; btn.textContent='ğŸ”Š æœ—è®€';
      (function(text){ btn.addEventListener('click', function(){ speak(text, 'en-US'); }); })(it.sentence);
      row.appendChild(en); row.appendChild(zh); row.appendChild(tk); row.appendChild(btn);
      row.style.border='1px solid #e5e7eb'; row.style.borderRadius='8px'; row.style.padding='8px'; row.style.background='#fff';
      box.appendChild(row);
    }
    contentEl.innerHTML=''; wrap.appendChild(box); contentEl.appendChild(wrap); return;
  }

  var table = document.createElement('table');
  var thead = document.createElement('thead');
  thead.innerHTML = '<tr><th style="width:38%">English</th><th style="width:28%">ä¸­æ–‡</th><th>è©å½™æ‹†è§£</th><th style="width:90px">æ“ä½œ</th></tr>';
  var tbody = document.createElement('tbody');

  if (!filtered.length){
    var tr = document.createElement('tr'); var td = document.createElement('td');
    td.colSpan=4; td.appendChild(emptyNode()); tr.appendChild(td); tbody.appendChild(tr);
  } else {
    for (var i4=0;i4<filtered.length;i4++){
      var item2 = filtered[i4];
      var tr2 = document.createElement('tr');
      var tdEn = document.createElement('td'); tdEn.textContent = item2.sentence;
      var tdZh = document.createElement('td'); tdZh.textContent = item2.zh || '';
      var tdTk = document.createElement('td');
      var toks = item2.tokens || [];
      for (var z=0; z<toks.length; z++){ tdTk.appendChild(chip(toks[z])); }
      var tdOp = document.createElement('td');
      var btnEn = document.createElement('button'); btnEn.className='speak-btn'; btnEn.textContent='ğŸ”Š'; btnEn.title='æœ—è®€è‹±æ–‡';
      (function(text){ btnEn.addEventListener('click', function(){ speak(text, 'en-US'); }); })(item2.sentence);
      var btnZh = document.createElement('button'); btnZh.textContent='ğŸ‡¹ğŸ‡¼'; btnZh.title='æœ—è®€ä¸­æ–‡';
      (function(text){ btnZh.addEventListener('click', function(){ speak(text || '', 'zh-TW'); }); })(item2.zh);
      tdOp.appendChild(btnEn); tdOp.appendChild(document.createTextNode(' ')); tdOp.appendChild(btnZh);
      tr2.appendChild(tdEn); tr2.appendChild(tdZh); tr2.appendChild(tdTk); tr2.appendChild(tdOp);
      tbody.appendChild(tr2);
    }
  }
  table.appendChild(thead); table.appendChild(tbody);
  contentEl.innerHTML=''; contentEl.appendChild(table);
}

function showWarn(msg){
  var tips = document.getElementById('tips');
  var box = document.createElement('div'); box.className='warn'; box.textContent=msg;
  tips && tips.after(box);
}

// åˆå§‹åŒ–
render();

/* ============ æ§åˆ¶åˆ—æŒ‰éˆ• ============ */
document.getElementById('refreshVoicesBtn').addEventListener('click', function(){
  try { synth && synth.cancel(); } catch(e){}
  populateVoices();
});
document.getElementById('testBtn').addEventListener('click', function(){
  if (!synth){ showWarn('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³ã€‚'); return; }
  speak('Hello! This is a voice test. ä½ å¥½ï¼Œé€™æ˜¯æ¸¬è©¦èªéŸ³ã€‚', 'en-US');
});
document.getElementById('stopBtn').addEventListener('click', function(){ synth && synth.cancel(); });

// Esc æ¸…æœå°‹
window.addEventListener('keydown', function(e){
  if (e.key==='Escape'){ searchInput.value=''; render(); }
});

// å˜—è©¦è¼‰å…¥èªéŸ³ï¼ˆéƒ¨åˆ†ç€è¦½å™¨éœ€ onvoiceschangedï¼‰
populateVoices();
if (window.speechSynthesis){
  window.speechSynthesis.onvoiceschanged = function(){ populateVoices(); };
}
</script>
</body>
</html>